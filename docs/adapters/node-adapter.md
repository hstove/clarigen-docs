---
sidebar_position: 4
sidebar_label: Node.js
title: Clarigen Node.js adapter
---

`clarigen/node` is an adapter for calling read-only and public functions on a Clarity contract in a node.js environment.

Using `clarigen/node` in node.js environments makes Stacks development much easier in:

- Server-side applications that fetch data or make transactions
- CLIs that interact with Stacks

## Quick example

```ts
import { contracts, accounts } from "../src/clarigen";
import { StacksMocknet } from 'micro-stacks/network';
import { NodeProvider } from '@clarigen/node';

const serverPrivateKey = "...";
const network = new StacksMocknet();

const deployerAddress = accounts.deployer.address;

const clarigen = NodeProvider({
  network,
  privateKey: serverPrivateKey;
  deployerAddress,
})

const counter = contracts.counter.contract;

// call a public function
export async function increment(): Promise<string> {
  const txPayload = counter.increment();
  const receipt = await clarigen.tx(txPayload);
  return receipt.txId;
}

// call a read-only function
export async function getCounter(): Promise<bigint> {
  return clarigen.ro(counter.getCounter());
}
```

## Configuration

The `NodeProvider` function allows you to configure a few common parameters, which are used when making contract calls.

- **`network`**: A `StacksNetwork` instance. For the best experience use `micro-stacks/network`, although `@stacks/network` instances work as well.
- **`deployerAddress`**: An optional `string` indicating the Stacks principal that deployed your contract. This is useful for apps that have different deployer addresses for mocknet, testnet, and mainnet. If this isn't provided, the address of your `deployer` in `Devnet.toml` Clarinet settings is used.
- **`privateKey`**: An optional `string`. This is only required if your code is making actual transactions. If you're only making read-only function calls, you don't need to configure this.

## API

The result of `NodeProvider` is an object containing functions for interacting with your contracts.

### `tx`

```ts
tx(contractCall: ContractCall, txOptions: Partial<ContractCallOptions>): Promise<Receipt>
```

`tx` will create and broadcast a contract call transaction.

The first argument is a `ContractCall`, which is auto-generated by Clarigen. The second argument includes any extra options you want to include in this transaction. Any valid options that could be passed to `makeContractCall` from `micro-stacks` or `@stacks/transactions` are available. For example, you can use this parameter to include post conditions, fee, nonce, etc.

```ts
const txPayload = await myToken.transfer(100n, sender, recipient, null);
const reciept = await provider.tx(txPayload, {
  postConditionMode: PostConditionMode.Allow,
  fee: 1500n,
  nonce: 12,
});
```

### `ro`

```ts
ro(contractCall: ContractCall<T>): Promise<T>;
```

Call a read-only function and get the result (in JS-native types). For example, if you have a function that returns a `uint`, this returns a `bigint`.

### `roOk`

Just like `ro`, this calls a read-only function and returns the `Ok` value of a response. This can only be used on functions that return a `response` type. If the result is an `Err` response, this function will throw an exception.

```ts
const tx = myToken.getBalance("ST1234"); // ContractCall<Response<bigint, none>>
const balance = await provider.roOk(tx); // bigint
```

### `roErr`

The opposite of `roOk`, this calls a read-only function and returns the `Err` value of a response. This can only be used on functions that return a `response` type. If the result is an `Ok` response, this function will throw an exception.

### `mapGet`

Get the value from a map for a specific key.

`mapGet` always returns the type `value | null`. For example, if the type of your map's values are `uint`, the result of `mapGet` is `bigint | null`.

```clarity
(define-map simple-map uint bool)
```

```ts
const hasOne = await provider.mapGet(myContract.simpleMap(0n)); // `boolean | null`
```
