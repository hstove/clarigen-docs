---
sidebar_position: 3
sidebar_label: Web
title: Clarigen Web Adapter
---

`@clarigen/web` is an adapter for calling read-only and public functions on a Clarity contract in a web environment. For read-only functions, it uses the same HTTP interface as the [node](./node-adapter.md) adapter. When calling public functions, it uses [micro-stacks](https://github.com/fungible-systems/micro-stacks) to interact with a wallet provided by the user's browser.

## Quick example

```ts
import { tx, ro } from "@clarigen/web";
import { contracts } from "./clarigen";
import { StacksMocknet } from "micro-stacks/network";

const deployerAddress = "ST123..."; // the address that deployed this contract
const counter = contract.counter.contract(
  deployerAddress,
  "counter-contract-name"
);

const network = new StacksMocknet();

// a function to get the current user's app private key
function getAppPrivateKey() {
  // in micro-stacks-react, this might be:
  // const session = useAtomValue(stacksSessionAtom);
  const session = JSON.parse(localStorage.getItem("stacks-session"));
  return session?.appPrivateKey;
}

// call a public function
export async function increment(): Promise<string> {
  const txPayload = counter.increment();
  const privateKey = getAppPrivateKey();
  if (!privateKey) {
    throw new Error("Can't make transaction - user isn't logged in");
  }
  const receipt = await tx(txPayload, {
    network,
    privateKey,
  });
  return receipt.txId;
}

// call a read-only function
export async function getCounter(): Promise<bigint> {
  return ro(counter.getCounter(), { network });
}
```

## API

### `tx`

`tx` will create and submit a transaction to the wallet provided by the user's browser.

The first argument is a `ContractCall`, which is auto-generated by Clarigen. The second argument includes any extra options you want to include in this transaction. Any valid options that could be passed to `makeContractCallToken` from `micro-stacks/connect`. For example, you can use this parameter to include post conditions, the `sponsored` flag, etc.

```ts
const txPayload = await myToken.transfer(100n, sender, recipient, null);
const reciept = await tx(txPayload, {
  postConditionMode: PostConditionMode.Allow,
  network: new StacksMainnet(),
  privateKey: currentUser.appPrivateKey,
});
```

### `ro`

```ts
ro(contractCall: ContractCall<T>, { network: StacksNetwork }): Promise<T>;
```

Call a read-only function and get the result (in JS-native types). For example, if you have a function that returns a `uint`, this returns a `bigint`.

### `roOk`

Just like `ro`, this calls a read-only function and returns the `Ok` value of a response. This can only be used on functions that return a `response` type. If the result is an `Err` response, this function will throw an exception.

```ts
const tx = myToken.getBalance("ST1234"); // ContractCall<Response<bigint, none>>
const balance = await roOk(tx, { network }); // bigint
```

### `roErr`

The opposite of `roOk`, this calls a read-only function and returns the `Err` value of a response. This can only be used on functions that return a `response` type. If the result is an `Ok` response, this function will throw an exception.
